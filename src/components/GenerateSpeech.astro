---
import { ElevenLabsClient } from '@elevenlabs/elevenlabs-js';

import { writeFile } from 'fs/promises'

const { script } = Astro.props

const elevenlabs = new ElevenLabsClient({ apiKey: import.meta.env.ELEVENLABS_KEY})

const createAudioFileFromText = async (text) => {
  return new Promise (async (resolve, reject) => {
    try {
      const audio = await elevenlabs.textToSpeech.convert('JBFqnCBsd6RMkjVDRZzb', {
        // modelId: 'eleven_multilingual_v2',
        modelId: 'eleven_flash_v2_5',
        text,
        outputFormat: 'mp3_44100_128',
        // Optional voice settings that allow you to customize the output
        voiceSettings: {
          stability: 0,
          similarityBoost: 0,
          useSpeakerBoost: true,
          speed: 1.0,
        },
      });


      const fileName = `somefile.mp3`;
      await writeFile(fileName, audio); // Write buffer directly to file
      return fileName;

    } catch (error) {
      reject(error);
    }
  });
};

await createAudioFileFromText('hello world')

---
sss